/*jslint unparam: true*/
;(function(g){var r,s,w,h,j,v=[],d,c,q,k,n;function p(y,z){var x=g("."+z.selectedTile);if(x.attr("id")==="portfolio"){g(".heading, #gallery",w).show();s.hide();}}function m(y,x){g("body").removeClass("columns-1 columns-2 columns-3").addClass("columns-"+x.columns);g(".heading",r).each(function(){var z=g(this);if(x.columns===1){z.attr("title",z.text());}else{z.removeAttr("title");}});}function e(y){var x=g(y.target);if(x.hasClass("active")){return false;}g(".accordion > dl dd").hide();x.parent().next().show();r.shufflingTiles("resizeGrid");g("dt a",j).removeClass("active");x.addClass("active");x.siblings().removeClass("accent");return false;}function u(z,y){var x;x=g("div.overlay",z);if(!y){x.spin(false).fadeOut();return;}if(x.length===0){x=g('<div class="overlay" />');z.append(x);}x.width(z.width());x.height(z.height());x.fadeIn().spin({color:g("h1",w).css("color")});}function i(y){var x,z;x=g(y.target);z=x.serializeArray();u(h,true);g.ajax({type:"POST",url:"mail.php",data:z,dataType:"json",success:function(B,C,A){u(h,false);if(B&&B.status==="ok"){g("#formFeedback",h).html(B.msg);x.remove();}else{g("#formFeedback",h).replaceWith(B.msg);}r.shufflingTiles("resizeGrid");},error:function(A,C,B){u(h,false);}});return false;}function b(){var x;if(!w.hasClass("open-tile")){return;}x=g("figure p:first img",s);x.css("height","auto");if(!s.is(":visible")){g(".closeBtn, .heading, .subheading, #gallery",w).hide();s.fadeIn("slow");}u(w,false);r.shufflingTiles("resizeGrid");}function t(A){var D,x,B,C,y,z;g("figure",s).remove();D=g(A.currentTarget).addClass("visited");x=s.prepend("<figure>"+D.html()+"</figure>");y=g("p:first img",x);z=y.attr("src").replace("_th.",".");u(w,true);y.load(b);y.css("height","120px");y.attr("src",z);C=D.prev();if(C.length===0){g("#prevBtn",s).hide();}else{g("#prevBtn",s).show().unbind("click").bind("click",function(){C.click();});}B=D.next();if(B.length===0){g("#nextBtn",s).hide();}else{g("#nextBtn",s).show().unbind("click").bind("click",function(){B.click();});}}function l(){u(w,false);s.hide();g(".closeBtn, .heading, .subheading, #gallery",w).show();r.shufflingTiles("resizeGrid");}function a(C,E){var D,z,y,B,x,A;D=E.selectedTile;v=[];if(E.columns===3&&g("."+D).attr("id")!=="portfolio"){z=r.data("data").grid;B=z.gridHeight;y=z.tilePadding;x=E.tiles.length;A=parseInt(r.css("paddingTop"),10)||0;g.each(E.tiles,function(F,H){var G,I;G=g(H.node);if(!G.hasClass(D)){I=G.css("top");v.push([G,I]);}});v.sort(function(G,F){return G[1]-F[1];});g.each(v,function(J,H){var G,I,F;G=H[0];if(D==="tile1"){F=B/(x-1);I=J*F+y+A;}else{if(G.hasClass("tile1")){F=B*0.3;I=y+A;}else{F=(B*0.7)/(x-2);I=(J-1)*F+y+(B*0.3)+A;}}F-=y*2;G.animate({top:I,height:F},400,"linear");});}}function f(){g.each(v,function(A,z){var y,x;y=z[0];x=y.data("data").shuffleLayout;y.css({top:x.y,height:x.h});});v=[];}function o(y){var x,z;x=c.data("slider");z=x.duration;if(!q){q=g('<img style="z-index: 100; opacity:0; display:none;" />');d.append(q);}if(y==="pause"){q.css({display:"none"});clearTimeout(k);k=setTimeout(o,z,"play");}else{if(y==="play"){q.attr("src",c.attr("src")).css({opacity:1,display:"block"});q.animate({opacity:0},1200,function(){o("pause");});x.current=(x.portraits[x.current+1])?x.current+1:0;c.attr("src",x.portraits[x.current]).css({opacity:0});c.animate({opacity:1},1000);}}}g(document).ready(function(){var x,y;g("body").removeClass("noJS");s=g("#lightBox");w=g("#portfolio");h=g("#contact");j=g("#resume");r=g("#vCard");r.bind("onLayout",m);r.shufflingTiles({layout:"fluid",deepLinking:true,tilePadding:3,tileHeight:158,openSpeed:1200,closeSpeed:900});r.bind("tileClose",p);r.bind("tileOpen",a);r.bind("shuffleStart",f);g(".shufflingTiles-tile",r).hover(function(){if(!g(this).hasClass("open-tile")){g(".heading",this).addClass("hover");}},function(){g(".heading",this).removeClass("hover");});g.each(["profile","portfolio","resume","services","contact"],function(z,B){var A=new Image();A.src="images/"+B+"_1.png";});g("#contactForm").submit(i).append('<input type="hidden" name="ajax" value="1" />');x=document.createElement("input");if(!x||!x.placeholder){g(":input").each(function(){var z=g(this),A=z.attr("placeholder");if(A){z.val(A);}});}g("#gallery figure").bind("click",t);g("#xBtn",s).bind("click",l);g("img",s).live("load",function(){u(w,false);});g(".accordion > dl dt").each(function(){var A,z;z=g(this);A=g("<a href='javascript:void()'>"+z.text()+"</a>");z.html(A);});g(".accordion > dl dd").hide();g(".accordion > dl dt a").click(e);n=g("#slideshow");y={portraits:[],current:0,loaded:0};y.duration=n.attr("data-duration")*1000||15000;g("img",n).each(function(){y.portraits.push(g(this).attr("src"));y.loaded+=1;});n.remove();if(y.portraits[0]){d=g('<div class="icon"><img src="'+y.portraits[0]+'" /></div>');g("#home").prepend(d);c=g("img",d);}if(y.portraits.length>1){c.data("slider",y);o("pause");}g("#skills li").each(function(){var A,B,z;B=g(this);A={"one-star":'<span class="accent">c</span>dddd',"two-star":'<span class="accent">cc</span>ddd',"three-star":'<span class="accent">ccc</span>dd',"four-star":'<span class="accent">cccc</span>d',"five-star":'<span class="accent">ccccc</span>'};A='<span class="stars">'+A[B.attr("class")]+"</span>";z=A+" "+B.html();B.html(z);});});}(jQuery));